<!doctype html>
<html lang="en">
	<head>
		<title>Venice Bridges</title>
		<link rel="stylesheet" type="text/css" href="css/main.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script type='text/javascript' src='https://cdn.firebase.com/v0/firebase.js'></script>
		<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAyOAA9mi5u_6cH_5TNoOYFIyPzT3q3mpA&sensor=false"></script>
		<script type='text/javascript' src='js/ck-console.js'></script>
		
		<!-- bootstrap-->
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css">
		<script type='text/javascript' src='js/bootstrap.min.js'></script>
		
		<!-- bootstrap slider-->
		<link rel="stylesheet" type="text/css" href="css/slider.css">
		<script type='text/javascript' src='js/bootstrap-slider.js'></script>
		
		<script type='text/javascript'>
			var markers = {};
			var canals;
			var map;
			var ckConsole = new CKConsole();
			
			$( document ).ready(function() {
				var mapOptions = {
					center: new google.maps.LatLng(45.436 , 12.334),
					zoom: 14,
					panControl: false,
					zoomControl: false,
					streetViewControl: false,
					mapTypeId: google.maps.MapTypeId.ROADMAP,
					styles: [
						{
							"featureType": "poi",
							"elementType": "labels",
							"stylers": [
								{ "visibility": "off" }
							]
						},
						{
							"featureType": "landscape.man_made",
							"elementType": "geometry",
							"stylers": [
								{ "visibility": "off" }
							]
						}
					]
				};
				map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
				
				
				ckConsole.getGroup('SegmentMaps', function(group){
					for(var id in group.members){
						var member = group.members[id];
						console.log(member);
						var polygon = CKConsoleUtil.geoJsonToGoogleMaps(member.shape,	{
																							strokeColor: '#000000',
																							strokeOpacity: 0.8,
																							strokeWeight: 1,
																							fillColor: '#FF0000',
																							fillOpacity: 0.35
																						});
						polygon.setMap(map);
						markers[id] = polygon;
					}
					canals = group.members;
				});
				
				$('.slider').slider({formater:function(val){
					return val+" m";
				}})
				$('.slider').on('slide', function() {
					var waterHeight = parseInt($("#waterSlider").val());
					var boatHeight = parseInt($("#boatSlider").val());
					for(var id in canals){
						var canal = canals[id];
						var marker = markers[id];
						var data = canal.data.lung;
						if(data<waterHeight && data>boatHeight){
							if(marker.getMap()!=map)
								marker.setMap(map);
						}
						else{
							if(marker.getMap()!=null)
								marker.setMap(null);
						}
					}
				});
				
			});
		</script>
	</head>
	<body>
		<div style="width:100%;height:100%;">
			<div id="map-canvas" style="width:100%;height:100%;"/>
		</div>
		
		<div style="position:absolute;bottom:0;right:0;background-color:rgba(255,255,255,0.3);padding:15px;">
			<input id="waterSlider" class="slider" type="text" value="" data-slider-min="0" data-slider-max="400" data-slider-step="1" data-slider-value="400" data-slider-orientation="vertical" data-slider-tooltip="hide" style="margin:10px;"/>
			<input id="boatSlider" class="slider" type="text" value="" data-slider-min="0" data-slider-max="400" data-slider-step="1" data-slider-value="0" data-slider-orientation="vertical" data-slider-tooltip="hide" style="margin:10px;"/>
		</div>
	</body>
</html>